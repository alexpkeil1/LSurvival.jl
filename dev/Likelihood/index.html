<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Likelihood functions · LSurvival: survival analysis for left-truncated, right-censored outcomes</title><meta name="title" content="Likelihood functions · LSurvival: survival analysis for left-truncated, right-censored outcomes"/><meta property="og:title" content="Likelihood functions · LSurvival: survival analysis for left-truncated, right-censored outcomes"/><meta property="twitter:title" content="Likelihood functions · LSurvival: survival analysis for left-truncated, right-censored outcomes"/><meta name="description" content="Documentation for LSurvival: survival analysis for left-truncated, right-censored outcomes."/><meta property="og:description" content="Documentation for LSurvival: survival analysis for left-truncated, right-censored outcomes."/><meta property="twitter:description" content="Documentation for LSurvival: survival analysis for left-truncated, right-censored outcomes."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">LSurvival: survival analysis for left-truncated, right-censored outcomes</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Help</a></li><li><span class="tocitem">Details</span><ul><li class="is-active"><a class="tocitem" href>Likelihood functions</a><ul class="internal"><li><a class="tocitem" href="#Introduction:"><span>Introduction:</span></a></li><li><a class="tocitem" href="#Definitions:"><span>Definitions:</span></a></li><li><a class="tocitem" href="#Likelihoods-for-survival-data-subject-to-right-censoring-and-left-truncation"><span>Likelihoods for survival data subject to right censoring and left truncation</span></a></li><li><a class="tocitem" href="#Parametric-likelihoods"><span>Parametric likelihoods</span></a></li><li><a class="tocitem" href="#Semi-parametric-partial-likelihoods"><span>Semi-parametric partial likelihoods</span></a></li><li><a class="tocitem" href="#Time-varying-covariates"><span>Time-varying covariates</span></a></li><li><a class="tocitem" href="#Numerical-algorithms"><span>Numerical algorithms</span></a></li></ul></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../nonparametric/">Non-parametric survival analysis</a></li><li><a class="tocitem" href="../coxmodel/">Semi-parametric survival analysis with Cox models</a></li><li><a class="tocitem" href="../parametric/">Parametric survival analysis with AFT models</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Details</a></li><li class="is-active"><a href>Likelihood functions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Likelihood functions</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/alexpkeil1/LSurvival.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/alexpkeil1/LSurvival.jl/blob/main/docs/src/Likelihood.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Likelihood-functions-for-time-to-event-observations-subject-to-left-truncation-and-right-censoring"><a class="docs-heading-anchor" href="#Likelihood-functions-for-time-to-event-observations-subject-to-left-truncation-and-right-censoring">Likelihood functions for time-to-event observations subject to left-truncation and right censoring</a><a id="Likelihood-functions-for-time-to-event-observations-subject-to-left-truncation-and-right-censoring-1"></a><a class="docs-heading-anchor-permalink" href="#Likelihood-functions-for-time-to-event-observations-subject-to-left-truncation-and-right-censoring" title="Permalink"></a></h1><h2 id="Introduction:"><a class="docs-heading-anchor" href="#Introduction:">Introduction:</a><a id="Introduction:-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction:" title="Permalink"></a></h2><p>Parametric survival models in <code>LSurvival</code> are parameterized as accelerated failure time models, where model parameters for associations between covariates and survival outcomes are interpreted as changes to the expected life span. The likelihood and parameterization are discussed briefly here to give some sense of the underlying interpretation of the approach, but this discussion is not intended to replace more thorough treatments in survival analysis texts.</p><h2 id="Definitions:"><a class="docs-heading-anchor" href="#Definitions:">Definitions:</a><a id="Definitions:-1"></a><a class="docs-heading-anchor-permalink" href="#Definitions:" title="Permalink"></a></h2><ul><li>Random variable <span>$E$</span>: time at beginning of observation</li><li>Random variable <span>$T$</span>: time at end of observation</li><li>Random variable <span>$Y$</span>: event indicator (1=yes, 0=no)</li><li>Realization <span>$e_i$</span>: time at study entry for observation <span>$i$</span></li><li>Realization <span>$t_i$</span>: time at study end for observation <span>$i$</span></li><li>Realization <span>$y_i$</span>: event indicator (1=yes, 0=no) for observation <span>$i$</span></li><li>Realization <span>$\mathbf{x}_i$</span>: covariate vector for observation <span>$i$</span></li><li>Function <span>$f(t)$</span>: probability density function evaluated at <span>$T=t$</span></li><li>Function <span>$S(t)=Pr(T&gt;t)$</span>: survival function evaluated at <span>$T=t$</span>, where <span>$S(0)= 1$</span></li><li>Function <span>$\mathscr{L} \equiv\mathscr{L}(t,e,y;\theta)$</span>: likelihood function for observed data under a parametric distribution with parameters <span>$\theta$</span></li></ul><h2 id="Likelihoods-for-survival-data-subject-to-right-censoring-and-left-truncation"><a class="docs-heading-anchor" href="#Likelihoods-for-survival-data-subject-to-right-censoring-and-left-truncation">Likelihoods for survival data subject to right censoring and left truncation</a><a id="Likelihoods-for-survival-data-subject-to-right-censoring-and-left-truncation-1"></a><a class="docs-heading-anchor-permalink" href="#Likelihoods-for-survival-data-subject-to-right-censoring-and-left-truncation" title="Permalink"></a></h2><p>We then have that the likelihood for i.i.d. data decomposes as</p><p class="math-container">\[\begin{aligned}
\mathscr{L} =&amp; \prod_i \mathscr{L}_i\\
\mathscr{L}_i =&amp; \frac{f(t_i)^{y_i}S(t_i)^{(1-y_i)}}{S(e_i)}
\end{aligned}\]</p><p>With the log-likelihood (<span>$\ln\mathscr{L}$</span>) given as:</p><p class="math-container">\[\begin{aligned}
\ln\mathscr{L} =&amp; \ln\bigg(\prod_i \mathscr{L}_i\bigg)\\
   =&amp; \sum_i \ln\mathscr{L}_i\\
\ln\mathscr{L}_i =&amp; {y_i}\ln f(t_i) + (1-y_i)\ln S(t_i) - \ln S(e_i)
\end{aligned}\]</p><p>Meaning that the likelihood (and log-likelihood) under a survival model are calculable using the probability density function and the survival function (or natural log-transformations of those function outputs)</p><h3 id="Special-case:-person-period-data"><a class="docs-heading-anchor" href="#Special-case:-person-period-data">Special case: person-period data</a><a id="Special-case:-person-period-data-1"></a><a class="docs-heading-anchor-permalink" href="#Special-case:-person-period-data" title="Permalink"></a></h3><p>&quot;Person period data&quot; allows us to split data from an individual into multiple observations, so that an individual can be right-censored in their first observation and then left-truncated in their second observation at the same time. In this case, the likelihood contribution for individual <span>$i$</span> (<span>$E_i=e_i, T_i=t_i$</span>, <span>$y_i=1$</span>) can be split over two person-periods (<span>$j\in {1,2}$</span>), where the first period starts at the entry time of the individual (<span>$e_{i1} = e_i$</span>) is right censored (<span>$y_{i1}=0$</span>) since we know the individual survives that period, and the second period includes late-entry immediately after the first period (<span>$e_{i2}=t_{i1}$</span>) and the failure time (<span>$y_{i2}=1$</span>, <span>$t_{i2}=t_{i}$</span>), since we know the individual experienced some time at risk before that period and failed within that period. This likelihood decomposition is given as:</p><p class="math-container">\[\begin{aligned}
\mathscr{L}_i =&amp; \prod_j \mathscr{L}_{ij}\\
 =&amp; \prod_j\frac{f(t_{ij})^{y_{ij}}S(t_{ij})^{(1-y_{ij})}}{S(e_{ij})} \\
 =&amp; \frac{f(t_{i1})^{y_{i1}}S(t_{i1})^{(1-y_{i1})}}{S(e_{i1})} \times \frac{f(t_{i2})^{y_{i2}}S(t_{i2})^{(1-y_{i2})}}{S(e_{i2})}  \\
 =&amp; \frac{S(t_{i1})}{S(e_{ij}= e_i)} \times \frac{f(t_{i2}=t_i)^{y_{i2}=y_i}}{S(e_{i2}=t_{i1})} =  \frac{f(t_i)}{{S(e_i)}}
\end{aligned}\]</p><p>Which is exactly the likelihood we would observe if there were only one observation for this individual. Similar derivations can be made for censored individuals. This phenomena allows that, for example, covariates may differ across person-periods (time-varying covariates), and the general approach to likelihoods for left-truncated, right-censored survival data can readily accomodate this. The <code>LSurvival</code> module takes this general approach to defining the likelihood (and also the partial likelihood in Cox models) and so allows the estimation of effects of time-varying exposures as well as accomodating left truncation and right censoring. </p><p>One example of person-period data is shown below. Each circle represents a censoring event, which can occur because an individual survives to the end-of-follow-up, is lost-to-follow-up (individual level) or because they have a person-period that they survive until the end of (period or record level).  <img src="../fig/ppplot.svg" alt="Person-period plot"/></p><h2 id="Parametric-likelihoods"><a class="docs-heading-anchor" href="#Parametric-likelihoods">Parametric likelihoods</a><a id="Parametric-likelihoods-1"></a><a class="docs-heading-anchor-permalink" href="#Parametric-likelihoods" title="Permalink"></a></h2><p>Multiple parametric model forms are available in the <code>LSurvival</code> module. Here, we derive the specific parameterizations used in the module, which uses the location-scale characterization of regression models (also used in the <code>survival</code> package in <code>R</code>).</p><p>The distributions used here can be parameterized in several ways, and the parameterizations in <code>LSurvival</code> generally follow the &quot;location-scale&quot; parameterization. This parameterization allows that covariates are assumed to act in linear combinations on the natural log of the survival time, and a scale parameter (or parameters) influence the error distribution around that linear combination. In symbols, these models are of the form</p><p class="math-container">\[\ln(t_i) = \mathbf{X_i\beta} + \epsilon_i\]</p><p>Where <span>$\epsilon_i$</span> is an error term with a distribution determined by the assumed distribution of the survival times.</p><p>Traditional parameterizations (e.g. from the <code>Distributions</code> package) and their mapping to the location-scale parameterization are given below. Some distributions that are not yet implemented are included.</p><h3 id="Weibull-distribution"><a class="docs-heading-anchor" href="#Weibull-distribution">Weibull distribution</a><a id="Weibull-distribution-1"></a><a class="docs-heading-anchor-permalink" href="#Weibull-distribution" title="Permalink"></a></h3><p>Implemented as <code>LSurvival.Weibull()</code></p><p>The Weibull distribution can be parameterized as:  <span>$\begin{aligned}  f(t|\lambda,\gamma)=&amp;\lambda\gamma(\lambda t)^{\gamma-1}\exp(-(\lambda t)^{\gamma}) \\
S(t|\lambda,\gamma) =&amp; \exp(-(\lambda t)^{\gamma}) \end{aligned}$</span></p><p>This can be re-parameterized in terms of a &#39;location-scale&#39; parameterization for modeling of the natural-log of the survival times. </p><h4 id="Derivation:"><a class="docs-heading-anchor" href="#Derivation:">Derivation:</a><a id="Derivation:-1"></a><a class="docs-heading-anchor-permalink" href="#Derivation:" title="Permalink"></a></h4><p>Let <span>$\gamma = \exp(-\rho), \lambda = \exp(-\alpha), z=\frac{\ln(t)-\alpha}{exp(\rho)}$</span> and using <span>$t=\exp(\ln(t))$</span>, we have that <span>$\begin{aligned}  f(t|\lambda,\gamma)=&amp;\lambda\gamma(\lambda t)^{\gamma-1}\exp(-(\lambda t)^{\gamma}) \\
=&amp;\exp(-\rho+z-\ln(t)-\exp(z)) \\
\ln f(t|\alpha,\rho)= &amp;  z -\exp(z) -\rho -\ln(t)  \\
\end{aligned}$</span></p><p>And  <span>$\begin{aligned}  S(t|\lambda,\gamma) =&amp; \exp(-(\lambda t)^{\gamma})\\
S(t|\alpha,\rho)=&amp;\exp(-(\exp(-\alpha) \exp(\ln(t)))^{\exp(-\rho)}) \\
=&amp;\exp(-\exp(z)) \\
\ln S(t|\alpha,\rho)=&amp;-\exp(z) \\
\end{aligned}$</span></p><p>Under this parameterization, the hazard function <span>$h(t|\alpha, \rho)$</span> can be expressed as</p><p class="math-container">\[\begin{aligned} 
h(t|\alpha, \rho) =&amp; f(t|\alpha, \rho)/S(t|\alpha,\rho)\\
\ln h(t|\alpha, \rho) =&amp;\ln f(t|\alpha, \rho) - \ln S(t|\alpha,\rho)\\
=&amp;  z -\exp(z) -\rho -\ln(t) - (-\exp(z)) \\
=&amp; z -\rho -\ln(t) \\
=&amp; \ln(t)\exp(-\rho)-\alpha{}\exp(-\rho) -\rho -\ln(t) \\
h(t|\alpha, \rho) =&amp;\frac{\exp(\alpha)^{\exp(-\rho)}t^{\exp(-\rho)-1}}{\exp(\rho)} \\
\end{aligned}\]</p><p>Under this parameterization, the log likelihood can be defined in terms of the natural log of the survival time, allowing the &quot;location-scale&quot; parameterization of a parametric survival model:</p><p class="math-container">\[\begin{aligned} 
z_i =&amp; \frac{\ln(t_i)-\mathbf{x}_i\beta}{\sigma}\\
\ln(t_i) =&amp; \mathbf{x}_i\beta + \sigma z_i\\
z \sim D
\end{aligned}\]</p><p>Where the location parameter is given as <span>$\alpha = \mathbf{x}\beta$</span> and the scale parmameter <span>$\sigma=\exp(\rho)$</span> describes the magnitude of the error terms, whose distribution is <span>$D$</span> (e.g. in the case of the Weibull distribution for <span>$t$</span> (given <span>$\mathbf X$</span>), <span>$D$</span> is the extreme value distribution). Here, the association between covariates <span>$\mathbf{X}$</span> and the time-to-event outcome is characterized in terms of linear effects on the location parameter <span>$\alpha$</span>. Further details and interpretive assistance can be found in Kalbfleisch and Prentice.<sup class="footnote-reference"><a id="citeref-kf" href="#footnote-kf">[kf]</a></sup></p><p>Under this model, we note that the ratio of predicted times under <span>$\mathbf{X=x}$</span> and <span>$\mathbf{X=x&#39;}$</span>, denoted by <span>$T_{\mathbf x}$</span> and <span>$T_{\mathbf x&#39;}$</span>, respectively, is given as</p><p class="math-container">\[\begin{aligned} 
\frac{T_{\mathbf x}}{T_{\mathbf x&#39;}} =&amp; \frac{\exp(\alpha_{\mathbf x})}{\exp(\alpha_{\mathbf x&#39;})} \\
=&amp; \frac{\exp(\mathbf{x}\beta)}{\exp(\mathbf{x&#39;}\beta)} \\
=&amp; \exp((\mathbf{x}-\mathbf{x&#39;})\beta) \\
\end{aligned}\]</p><p>So that a unit change in the predictor leads to a relative change in the survival time of <span>$\exp(\beta)$</span> units. This &quot;time ratio&quot; can also be interpreted as the acceleration of the lifetime, hence this parametererization being labeled as an &quot;accelerated failure time&quot; model.</p><p>Under the Weibull distribution, the hazard ratio is given as</p><p class="math-container">\[\begin{aligned} 
\frac{h_{\mathbf x}(t|\lambda,\gamma)}{h_{\mathbf x&#39;}(t|\lambda,\gamma)} =&amp;\frac{\exp(\alpha_{\mathbf x})^{exp(-\rho)}}{\exp(\alpha_{\mathbf x})^{exp(-\rho)}} \\
=&amp;\frac{\exp( -\mathbf{x}\beta\exp(-\rho))}{\exp( -\mathbf{x&#39;}\beta\exp(-\rho))} \\
=&amp; \exp((\mathbf{x&#39;}-\mathbf{x})\beta\exp(-\rho)) \\
\end{aligned}\]</p><p>Which is proportional to the inverse of the time ratio, meaning that a predictor that proportionally increases the hazard of <span>$Y$</span> also proportionally decreases the survival time. For the Weibull (and exponential) distribution hazard ratio can be derived from the AFT model by simply exponentiating the negative value of the AFT parameters divided by the model scale parameter (e.g. <span>$\exp(-\beta\exp(-\rho))$</span>, which reduces to <span>$\exp(-\beta)$</span> in the Exponential model)</p><h3 id="Exponential-distribution"><a class="docs-heading-anchor" href="#Exponential-distribution">Exponential distribution</a><a id="Exponential-distribution-1"></a><a class="docs-heading-anchor-permalink" href="#Exponential-distribution" title="Permalink"></a></h3><p>Implemented as <code>LSurvival.Exponential()</code></p><p>This is a special case of the Weibull log-likelihood in which <span>$\gamma=1$</span> (or, equivalently <span>$\rho=0$</span>)</p><p class="math-container">\[\begin{aligned} 
f(t)=&amp;\lambda\exp(-\lambda t) \\
S(t) =&amp; \exp(-\lambda t)
\end{aligned}\]</p><p>Then, again letting <span>$\lambda = \exp(-\alpha)$</span> and using <span>$t=\exp(\ln(t))$</span>, we have that</p><p class="math-container">\[\begin{aligned} 
\ln f(t)= &amp; \alpha - \exp(\ln(t) - \alpha) \\
\ln S(t)=&amp;-\exp(\ln(t) - \alpha) \\
\end{aligned}\]</p><p>which gives us the model</p><p class="math-container">\[\begin{aligned} 
\ln(t_i) =&amp; \mathbf{x}_i\beta + \epsilon_i \\
\epsilon \sim D
\end{aligned}\]</p><h3 id="Log-normal-distribution"><a class="docs-heading-anchor" href="#Log-normal-distribution">Log-normal distribution</a><a id="Log-normal-distribution-1"></a><a class="docs-heading-anchor-permalink" href="#Log-normal-distribution" title="Permalink"></a></h3><p>Implemented as <code>LSurvival.Lognormal()</code></p><p>Let <span>$\gamma = \exp(-\rho), \lambda = \exp(-\alpha), z=\frac{\ln(t)-\alpha}{exp(\rho)}$</span> and using <span>$t=\exp(\ln(t))$</span>, we have that</p><p class="math-container">\[\begin{aligned} 
f(t|\lambda,\gamma)=&amp;(2\pi)^{-1/2}\gamma t^{-1} \exp\bigg(\frac{-\gamma^2(\ln(\lambda t))^2}{2}   \bigg) \\
f(t|\alpha,\rho)=&amp;(2\pi)^{-1/2}\exp(-\rho) \exp(\ln(t))^{-1} \exp\bigg(\frac{-\exp(-\rho)^2(\ln(\exp(-\alpha) \exp(\ln(t))))^2}{2}   \bigg) \\
=&amp;(2\pi)^{-1/2} \exp\big(-z^2/2 - \ln(t) - \rho \big) \\
\\
\\
S(t|\lambda,\gamma) =&amp; 1 - \Phi\big(\gamma \ln(\lambda t)\big)\\
S(t|\alpha,\rho) =&amp; 1 - \Phi\big(z\big)
\end{aligned}\]</p><h3 id="Generalized-Gamma-distribution"><a class="docs-heading-anchor" href="#Generalized-Gamma-distribution">Generalized Gamma distribution</a><a id="Generalized-Gamma-distribution-1"></a><a class="docs-heading-anchor-permalink" href="#Generalized-Gamma-distribution" title="Permalink"></a></h3><p>Implemented as <code>LSurvival.GGamma()</code></p><p>Limiting cases:</p><ul><li>Weibull (<span>$k=1$</span>)</li><li>Gamma (<span>$\gamma=1$</span>)</li><li>Log-normal (as <span>$k\rightarrow \infty$</span>)</li><li>Exponential (<span>$\gamma=k=1$</span>)</li></ul><p>Let <span>$\gamma = \exp(-\rho), \lambda = \exp(-\alpha), k=\exp(\kappa), z=\frac{\ln(t)-\alpha}{exp(\rho)}$</span> and using <span>$t=\exp(\ln(t))$</span>, we have that</p><p class="math-container">\[\begin{aligned} 
\\
f(t|\lambda,\gamma,k)=&amp;\frac{\gamma\lambda(\lambda t)^{\gamma k - 1}\exp(-(\lambda t)^\gamma)}{\Gamma(k)}\\
f(t|\alpha,\rho,\kappa)=&amp;\frac{\exp(-\rho)\exp(-\alpha)(\exp(-\alpha) \exp(\ln(t)))^{\exp(-\rho) \exp(\kappa) - 1}\exp(-(\exp(-\alpha) \exp(\ln(t)))^{\exp(-\rho)})}{\Gamma(\exp(\kappa))}\\
=&amp;\frac{\exp(-\alpha)\exp((\ln(t)-\alpha)(\exp(-\rho) \exp(\kappa) - 1))-\rho)\exp(- \exp((\ln(t)-\alpha)\exp(-\rho))))}{\Gamma(\exp(\kappa))}\\
=&amp;\frac{\exp(z \exp(\kappa)-\alpha - \ln(t)+\alpha-\rho-\exp(z))}{\Gamma(\exp(\kappa))}\\
\ln f(t|\alpha,\rho,\kappa)=&amp;z\exp(\kappa)-\exp(z)-\rho -\ln(t) - \ln\Gamma(\exp(\kappa))\\
\end{aligned}\]</p><p>and</p><p class="math-container">\[\begin{aligned} 
S(t|\lambda,\gamma,k)=&amp;1-I(k,(\lambda t)^\gamma)\\
S(t|\alpha,\rho,\kappa)=&amp;1-I( \exp(\kappa),\exp(\ln(t)-\alpha)^{\exp(-\rho)})\\
\ln S(t|\alpha,\rho,\kappa)=&amp;\ln(1-I(\exp(\kappa)), \exp(z))\\
\end{aligned}\]</p><p>Where we define <span>$I(k,s)$</span> as the upper incomplete gamma function ratio given by</p><p class="math-container">\[I(k,s) = \frac{\int_o^s t^{k-1}\exp(-t)dt}{\Gamma(k)}\]</p><p>(see <a href="https://specialfunctions.juliamath.org/stable/functions_list/#SpecialFunctions.gamma_inc"><code>gamma_inc</code></a> function from <a href="https://github.com/JuliaMath/SpecialFunctions.jl"><code>SpecialFunctions.jl</code></a>)</p><h3 id="Gamma-distribution"><a class="docs-heading-anchor" href="#Gamma-distribution">Gamma distribution</a><a id="Gamma-distribution-1"></a><a class="docs-heading-anchor-permalink" href="#Gamma-distribution" title="Permalink"></a></h3><p>Implemented as <code>LSurvival.Gamma()</code></p><p>Let <span>$\gamma = \exp(-\rho), \lambda = \exp(-\alpha), k=\exp(\kappa), z=\frac{\ln(t)-\alpha}{exp(\rho)}$</span> and using <span>$t=\exp(\ln(t))$</span>, we have that</p><p>Then Gamma distribution can be parameterized as <span>$\begin{aligned}  f(t|\lambda,k)=&amp; \frac{\lambda(\lambda t)^{k-1}exp(\lambda t)}{\Gamma(k)}\\
\ln f(t|\alpha,\kappa)=&amp;\ln(t)(\exp(\kappa)-1)-\alpha\exp(\kappa)-\exp(\ln(t)-\alpha)  - \ln\Gamma(\exp(\kappa))\\
\\
S(t|\lambda,k)=&amp; 1-I(k,\lambda t)\\
\ln S(t|\alpha,\kappa)=&amp;\ln(1-I(\exp(\kappa)), \exp(\ln(t)-\alpha))\\
\end{aligned}$</span></p><p>Where we define <span>$I(k,s)$</span> as the upper incomplete gamma function ratio given by</p><p class="math-container">\[I(k,s) = \frac{\int_o^s t^{k-1}\exp(-t)dt}{\Gamma(k)}\]</p><p>(see <a href="https://specialfunctions.juliamath.org/stable/functions_list/#SpecialFunctions.gamma_inc"><code>gamma_inc</code></a> function from <a href="https://github.com/JuliaMath/SpecialFunctions.jl"><code>SpecialFunctions.jl</code></a>)</p><h3 id="Log-logistic-distribution"><a class="docs-heading-anchor" href="#Log-logistic-distribution">Log-logistic distribution</a><a id="Log-logistic-distribution-1"></a><a class="docs-heading-anchor-permalink" href="#Log-logistic-distribution" title="Permalink"></a></h3><p>(not yet implemented)</p><h2 id="Semi-parametric-partial-likelihoods"><a class="docs-heading-anchor" href="#Semi-parametric-partial-likelihoods">Semi-parametric partial likelihoods</a><a id="Semi-parametric-partial-likelihoods-1"></a><a class="docs-heading-anchor-permalink" href="#Semi-parametric-partial-likelihoods" title="Permalink"></a></h2><p>In the Cox model, the partial-likelihoods are used in place of the likelihood function. These models are are modeled directly in terms of hazard ratios, allowing that the baseline hazard can be an arbitrary distribution. The Cox models implemented here are semi-parametric because they include a combination of parametric (hazard ratios) and non-parametric (baseline hazard) components. Cox&#39;s original likelihood is used here, and, in place of tied survival times, two different options are implemented for addressing ties. See the <code>survival</code><sup class="footnote-reference"><a id="citeref-surv" href="#footnote-surv">[surv]</a></sup> package vignette for original citations and methods for baseline hazard and partial-likelihood calculations.</p><h3 id="Efron&#39;s-partial-likelihood"><a class="docs-heading-anchor" href="#Efron&#39;s-partial-likelihood">Efron&#39;s partial likelihood</a><a id="Efron&#39;s-partial-likelihood-1"></a><a class="docs-heading-anchor-permalink" href="#Efron&#39;s-partial-likelihood" title="Permalink"></a></h3><p>This is the default in coxph (documentation in progress)</p><ul><li>Baseline hazard calculations are made using an analogue of the Fleming-Harrington estimator.</li></ul><h3 id="Breslow&#39;s-partial-likelihood"><a class="docs-heading-anchor" href="#Breslow&#39;s-partial-likelihood">Breslow&#39;s partial likelihood</a><a id="Breslow&#39;s-partial-likelihood-1"></a><a class="docs-heading-anchor-permalink" href="#Breslow&#39;s-partial-likelihood" title="Permalink"></a></h3><p>Documentation in progress</p><ul><li>Baseline hazard calculations are made using an analogue of the Nelson-Aalen estimator. </li></ul><h2 id="Time-varying-covariates"><a class="docs-heading-anchor" href="#Time-varying-covariates">Time-varying covariates</a><a id="Time-varying-covariates-1"></a><a class="docs-heading-anchor-permalink" href="#Time-varying-covariates" title="Permalink"></a></h2><p>Documentation in progress</p><h2 id="Numerical-algorithms"><a class="docs-heading-anchor" href="#Numerical-algorithms">Numerical algorithms</a><a id="Numerical-algorithms-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-algorithms" title="Permalink"></a></h2><p>Fitting algorithms include direct calculation, hard-coded Newton-Raphson algorithms, and optimization algorithms from the <code>Optim.jl</code> module:</p><h3 id="Non-parametric-analysis"><a class="docs-heading-anchor" href="#Non-parametric-analysis">Non-parametric analysis</a><a id="Non-parametric-analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Non-parametric-analysis" title="Permalink"></a></h3><ul><li>Kaplan-Meier: direct calculation</li><li>Aalen-Johansen: direct calculation</li></ul><h3 id="Semi-parametric-analysis"><a class="docs-heading-anchor" href="#Semi-parametric-analysis">Semi-parametric analysis</a><a id="Semi-parametric-analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Semi-parametric-analysis" title="Permalink"></a></h3><ul><li>Cox model, Efron&#39;s partial likelihood: Newton-Raphson with analytic gradient and Hessian, utilizing step-halving if the infinite norm of the gradient increases in a step.  </li><li>Cox model, Breslow&#39;s partial likelihood: Newton-Raphson with analytic gradient and Hessian, utilizing step-halving if the infinite norm of the gradient increases in a step. </li></ul><h3 id="Parametric-analysis"><a class="docs-heading-anchor" href="#Parametric-analysis">Parametric analysis</a><a id="Parametric-analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Parametric-analysis" title="Permalink"></a></h3><ul><li>AFT model (Weibull, Exponential, Log-normal): <a href="https://julianlsolvers.github.io/Optim.jl/stable/#algo/lbfgs/"><code>BFGS</code></a> algorithm from <a href="https://github.com/JuliaNLSolvers/Optim.jl/"><code>Optim.jl</code></a>, supplemented with analytic gradient and Hessian using a Hager-Zhang line-search algorithm and static scaling of the P matrix</li><li>AFT model (Gamma, Generalized gamma): <a href="https://julianlsolvers.github.io/Optim.jl/stable/#algo/lbfgs/"><code>BFGS</code></a> algorithm from <a href="https://github.com/JuliaNLSolvers/Optim.jl/"><code>Optim.jl</code></a> utilizing forward differencing to calculate gradient and approximate Hessian using a quadratic backtracking line-search algorithm with an initial quadratic approximation for scaling the P matrix</li></ul><hr/><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-kf"><a class="tag is-link" href="#citeref-kf">kf</a>Kalbfleisch, J. D., &amp; Prentice, R. L. (2011). The statistical analysis of failure time data, 2nd ed. John Wiley &amp; Sons.</li><li class="footnote" id="footnote-surv"><a class="tag is-link" href="#citeref-surv">surv</a><a href="https://cran.r-project.org/web/packages/survival/vignettes/validate.pdf">https://cran.r-project.org/web/packages/survival/vignettes/validate.pdf</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Help</a><a class="docs-footer-nextpage" href="../nonparametric/">Non-parametric survival analysis »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Monday 14 July 2025 18:29">Monday 14 July 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
